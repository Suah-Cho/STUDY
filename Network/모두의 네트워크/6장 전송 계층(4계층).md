# 6장 전송 계층(4계층)

**전송계층**

: 목적지에 신뢰할 수 있는 데이터를 전송하기 위해 필요

- 오류 점검 기능 존재 → 오류 발생 시 데이터 재전송 요청
- 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별

| 연결형 통신 | 신뢰할 수 있고 정확한 데이터를 전달하는 통신 | TCP 사용 |
| --- | --- | --- |
| 비연결형 통신 | 효율적으로 데이터를 전달하는 통신 | UDP 사용 |

### TCP 구조

**TCP란?**

: 연결형 통신 프로토콜

- TCP 헤더가 붙은 데이터를 세그먼트(segment)라고 한다.
- 데이터를 전송하려면 연결(connection)이라는 가상의 독접 통신로를 확보해야한다.
- TCP 헤더의 `코드 비트`에 연결의 제어 정보가 기록된다.
- 코드 비트의 초기값 : 0 / 활성화 : 1
    - 연결 확립하려면 SYN(연결 요청), ACK(확인 응답)가 필요
    - 연결 끊으려면 FIN(연결 종료), ACK(확인 응답)가 필요

**3-way 핸드셰이크**

: 데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세 번 교환하는 것

3-way핸드셰이크 과정

1. 컴퓨터1이 컴퓨터2에 연결 확립 요청(SYN)
2. 컴퓨터2가 컴퓨터1에게 연결 확립 응답(ACK) 및 연결 확립 요청(SYN)
3. 컴퓨터1이 컴퓨터 2에게 연결 확립 응답(ACK)

**일련 번호와 확인 응답 번호**

- 3-way 핸드셰이크가 끝나고 실제 데이터를 보내거나 받을 때 TCP헤더의 `일련번호`와 `확인응답번호`를 사용한다.

| 일련번호 | 송신 → 수신 | 몇 번째 데이터인지 송신했는지 |
| --- | --- | --- |
| 확인 응답 번호 | 수신 → 송신 | 몇 번째 데이터를 수신했는지 |
- 재전송 제어 : 일련번호와 확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우에 데이터를 재전송한다.

**윈도우 크기**

버퍼 : 받은 세그먼트를 일시적으로 보관하는 장소

오버플로(overflow) : 대량으로 데이터가 전송되면 보관하지 못하고 넘치는 현상

→ 버퍼의 한계 크기를 알고 있어야한다.

→ TCP헤더의 윈도우 크기(=얼마나 많은 용량의 데이터를 저장해 둘 수 있는지) 값에 해당

**포트 번호**

- 전송된 데이터의 목적지가 어떤 애플리케이션인지 구분
    
    → 출발지 포트 번호와 목적지 포트 번호 필요
    

| 잘 알려진 포트(well-known ports) | 0~1023번 포트 (주요 프로토콜이 사용하도록 예약)  | 일반적으로 사용하는 서버 측 애플리케이션에 사용 |
| --- | --- | --- |
|  | 1024번 (예약되어 있지만 사용되지 않는 포트) |  |
| 랜덤 포트 | 1025번 이상 | 클라이언트 측의 송신 포트로 사용 |

| 애플리케이션 | 포트 번호 |
| --- | --- |
| SSH | 22 |
| SMTP | 25 |
| DNS | 53 |
| HTTP | 80 |
| POP3 | 110 |
| HTTPS | 443 |
- `포트 번호를 붙이지 않고 통신하면 컴퓨터에 데이터가 도착하더라도 애플리케이션까지 도착할 수 없다.`
- 웹 브라우저로 접속할 때, 웹 브라우저에는 임의의 포트가 자동으로 할당된다.
    
    → 서버 측에서 포트 번호를 정해 둬야 하지만 클라이언트 측은 정하지 않아도 된다.
    

## UDP의 구조

**UDP란?**

장점 : 데이터를 효율적으로 빠르게 보낸다.

→ 스트리밍 방식으로 전송하는 동영상 서비스에 사용된다.

**UDP헤더란?**

: 올바른 목적지의 애플리케이션으로 데이터를 전송하기 위해 필요한 정보가 기록되어 있다.

- UDP데이터그램 : UDP헤더가 붙은 데이터
- UDP를 사용하면 브로드캐스트 가능
    - 브로드캐스트(broadcast) : 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보내는 것
    - TCP는 3-way핸드셰이크와 같이 데이터 전송하기 때문에 브로드캐스트와 같이 불특정 다수에게 보내는 통신에는 적합하지 않다.
